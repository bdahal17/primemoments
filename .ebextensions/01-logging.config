option_settings:
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 7

files:
  "/opt/elasticbeanstalk/tasks/logs/eb-logs.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/log/eb-activity.log
      /var/log/nginx/access.log
      /var/log/nginx/error.log
      /var/log/cfn-init.log
      /var/log/cfn-init-cmd.log
      /var/log/eb-commandprocessor.log
      /var/log/ecs/ecs-agent.log
      /var/log/ecs/ecs-agent.log.*

  "/opt/elasticbeanstalk/bin/log-streaming.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Enhanced logging script

      # Capture system information
      echo "=== System Information ===" >> /var/log/eb-custom-logs.log
      uname -a >> /var/log/eb-custom-logs.log
      date >> /var/log/eb-custom-logs.log

      # Capture resource usage
      echo "=== Resource Usage ===" >> /var/log/eb-custom-logs.log
      free -h >> /var/log/eb-custom-logs.log
      df -h >> /var/log/eb-custom-logs.log
      top -bn1 | head -n 10 >> /var/log/eb-custom-logs.log

      # Capture process list
      echo "=== Running Processes ===" >> /var/log/eb-custom-logs.log
      ps aux >> /var/log/eb-custom-logs.log

commands:
  01_enable_log_streaming:
    command: |
      # Ensure log streaming is enabled
      /opt/elasticbeanstalk/bin/log-streaming.sh
